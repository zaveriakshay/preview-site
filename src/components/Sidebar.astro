---
// src/components/Sidebar.astro
// This completely replaces Starlight's default sidebar with a version-aware one
import { generateVersionAwareSidebar } from '../utils/sidebar.ts';

// Get current path and generate version-specific sidebar
const currentPath = Astro.url.pathname;
const sidebarGroups = await generateVersionAwareSidebar(currentPath);
---

<nav class="sidebar-with-version" aria-label="Main navigation">
    <!-- Custom version-aware sidebar -->
    <div class="sidebar-content">
        {sidebarGroups.map(group => (
            <div class="sidebar-group">
                <h3 class="sidebar-group-label">
                    {group.label}
                </h3>
                <ul class="sidebar-group-list">
                    {group.items.map(item => (
                        <li class="sidebar-item">
                            <a 
                                href={item.link}
                                class={`sidebar-link ${currentPath === item.link || currentPath.startsWith(item.link) ? 'current' : ''}`}
                                aria-current={currentPath === item.link ? 'page' : undefined}
                            >
                                {item.text}
                                {item.badge && (
                                    <span class={`sidebar-badge ${item.badge.toLowerCase()}`}>
                                        {item.badge}
                                    </span>
                                )}
                            </a>
                            {item.items && (
                                <ul class="sidebar-sublist">
                                    {item.items.map(subItem => (
                                        <li class="sidebar-subitem">
                                            <a 
                                                href={subItem.link}
                                                class={`sidebar-sublink ${currentPath === subItem.link ? 'current' : ''}`}
                                                aria-current={currentPath === subItem.link ? 'page' : undefined}
                                            >
                                                {subItem.text}
                                            </a>
                                        </li>
                                    ))}
                                </ul>
                            )}
                        </li>
                    ))}
                </ul>
            </div>
        ))}
        
        {sidebarGroups.length === 0 && (
            <div class="sidebar-empty">
                <p>No content available for this version.</p>
            </div>
        )}
    </div>
</nav>

<style>
    .sidebar-with-version {
        height: 100%;
        display: flex;
        flex-direction: column;
        background: var(--sl-color-bg-sidebar);
        border-right: 1px solid var(--sl-color-gray-5);
        overflow: hidden;
    }

    .sidebar-content {
        flex: 1;
        overflow-y: auto !important;
        overflow-x: hidden !important;
        padding: 1rem 0;
        min-height: 0;
        height: auto;
    }

    .sidebar-group {
        margin-bottom: 1.5rem;
    }

    .sidebar-group-label {
        color: var(--sl-color-text);
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin: 0 0 0.5rem 1rem;
        padding: 0;
    }

    .sidebar-group-list {
        list-style: none;
        margin: 0;
        padding: 0;
    }

    .sidebar-item {
        margin: 0;
    }

    .sidebar-link {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 1rem;
        color: var(--sl-color-text);
        text-decoration: none;
        font-size: 0.875rem;
        line-height: 1.4;
        border-left: 3px solid transparent;
        transition: all 0.2s ease;
    }

    .sidebar-link:hover {
        background: var(--sl-color-gray-6);
        color: var(--sl-color-text-accent);
    }

    .sidebar-link.current {
        background: var(--sl-color-accent-low);
        color: var(--sl-color-accent);
        border-left-color: var(--sl-color-accent);
        font-weight: 600;
    }

    .sidebar-badge {
        padding: 0.125rem 0.375rem;
        border-radius: 0.75rem;
        font-size: 0.625rem;
        font-weight: 600;
        text-transform: uppercase;
        margin-left: 0.5rem;
    }

    .sidebar-badge.new {
        background: var(--sl-color-green);
        color: white;
    }

    .sidebar-badge.updated {
        background: var(--sl-color-blue);
        color: white;
    }

    .sidebar-sublist {
        list-style: none;
        margin: 0;
        padding: 0;
        background: var(--sl-color-gray-6);
    }

    .sidebar-subitem {
        margin: 0;
    }

    .sidebar-sublink {
        display: block;
        padding: 0.375rem 1rem 0.375rem 2rem;
        color: var(--sl-color-text-invert);
        text-decoration: none;
        font-size: 0.8125rem;
        line-height: 1.4;
        border-left: 3px solid transparent;
        transition: all 0.2s ease;
    }

    .sidebar-sublink:hover {
        background: var(--sl-color-gray-5);
        color: var(--sl-color-text-accent);
    }

    .sidebar-sublink.current {
        background: var(--sl-color-accent-low);
        color: var(--sl-color-accent);
        border-left-color: var(--sl-color-accent);
        font-weight: 600;
    }

    .sidebar-empty {
        padding: 2rem 1rem;
        text-align: center;
        color: var(--sl-color-text-invert);
        font-style: italic;
    }

    /* Responsive design */
    @media (max-width: 768px) {
        .sidebar-with-version {
            border-right: none;
            border-bottom: 1px solid var(--sl-color-gray-5);
        }
        
        .sidebar-content {
            max-height: 50vh;
        }
    }

    /* Scrollbar styling */
    .sidebar-content::-webkit-scrollbar {
        width: 6px;
    }

    .sidebar-content::-webkit-scrollbar-track {
        background: transparent;
    }

    .sidebar-content::-webkit-scrollbar-thumb {
        background: var(--sl-color-gray-4);
        border-radius: 3px;
    }

    .sidebar-content::-webkit-scrollbar-thumb:hover {
        background: var(--sl-color-gray-3);
    }
</style>